const { ethers } = require("ethers");
const config = require("./config/config");

class BlockchainService {
    constructor() {

        const blockchain = new BlockchainService();

        //Connecting to Sepolia
        this.provider = new ethers.JsonRpcProvider(config.rpcUrl);

        this.wallet = new ethers.Wallet(config.privateKey, this.provider);

        this.faucetAmount = ethers.parseEther(config.faucetAmount);
        this.minBalanceAlert = ethers.parseEther(config.minBalanceAlert);
    }
}

// the logic of the functions ... definiton of what the main functions, classes and setups 

async function hasEnoughBalance(address, requiredAmountInEth) {
    // now, get the balance in wei 
    const balanceWei = await provider.getBalance(address);
    // converting both balance and required amount to same unit in wei - converts ETH (like 0.1) to wei
    const requiredWei = ethers.parseEther(requiredAmountInEth.toString());

    // the return - checks if enough funds
    return balanceWei >= requiredWei;
}

function isValidAddress(address) {
    return ethers.isAddress(address);
}

// await = wait for this fucntion to finish before moving on

async function estimateGas(toAddress, fromWallet, amountInEth) {
    const tx = {
        to: toAddress,
        value: ethers.parseEther(amountInEth.toString()),
    };

    // provider estimates gas usuage for this transaction 
    const gasEstimate = await provider.estimateGas(tx);

    return gasEstimate;
}


async function main() {
    const blockchain = new BlockchainService();
    const validAddress = "0x1c28404a28f5f9659cec12862cdfcebd93bf5139";

    console.log("\nChecking balance...");
    const hasFunds = await hasEnoughBalance(blockchain.provider, testAddress, 0.1);
    console.log("Has enough balance:", hasFunds);

    console.log("\nChecking address validity...");
    console.log("Is valid address:", isValidAddress(testAddress));

    console.log("\nEstimating gas...");
    const gas = await estimateGas(blockchain.provider, testAddress, 0.01);
    console.log("Estimated gas:", gas.toString());
}

main().catch(console.error);


